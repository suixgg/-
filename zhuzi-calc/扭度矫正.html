<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>柱子平移与旋转计算器</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>📐</text></svg>">
  
  <!-- PWA 必要代码 -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">

  <style>
    :root {
      --bg: #0f172a;
      --card: rgba(15, 23, 42, 0.85);
      --accent: #06b6d4;
      --muted: #9aa7bd;
      --green: #10b981;
      --red: #ef4444;
      --gray: #9ca3af;
    }
    body { margin:0; font-family: "SF Pro Display", system-ui, -apple-system, Roboto;
      background: linear-gradient(160deg,#0a1224 0%,#081120 100%); color:#f1f5f9;
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;}
    .app { width:100%; max-width:420px; background:var(--card); border-radius:20px;
      padding:20px; backdrop-filter:blur(20px); box-shadow:0 10px 40px rgba(0,0,0,0.4);}
    h1 { text-align:center; font-size:20px; margin:0 0 6px 0; display:flex; align-items:center; justify-content:center; gap:6px; }
    .lead { text-align:center; font-size:13px; color:var(--muted); margin-bottom:18px;}
    .field { margin-bottom:14px; }
    label { font-size:13px; color:var(--muted); display:block; margin-bottom:6px;}
    input { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.05);
      background: rgba(255,255,255,0.05); color:#fff; font-size:15px; outline:none; }
    .pair-buttons { display:flex; gap:8px; margin-bottom:10px;}
    .pair-btn { flex:1; text-align:center; padding:10px 0; border-radius:8px; border:1px solid rgba(255,255,255,0.05);
      cursor:pointer; font-weight:600; background:rgba(255,255,255,0.05);}
    .pair-btn.active { background:var(--accent); color:#042028; }
    .buttons { display:flex; gap:10px; margin-top:10px;}
    button { flex:1; border:none; border-radius:10px; padding:10px; font-weight:600; cursor:pointer; font-size:15px; transition:all 0.2s ease;}
    .primary { background:linear-gradient(90deg,var(--accent),#22d3ee); color:#042028; }
    .ghost { background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.1); }
    button:active { transform:scale(0.96); }
    .results { margin-top:18px; display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    .card { background:rgba(255,255,255,0.04); border-radius:12px; padding:12px; text-align:center;
      box-shadow: inset 0 0 10px rgba(255,255,255,0.02); }
    .card.full { grid-column:1/-1; }
    .val { font-size:20px; font-weight:700; margin-bottom:4px; }
    .sub { font-size:12px; color:var(--muted); }
    .dir-red { color:var(--red); }
    .dir-green { color:var(--green); }
    .dir-gray { color:var(--gray); }
    details { margin-top:16px; font-size:13px; color:var(--muted);}
    summary { cursor:pointer; color:var(--accent); font-weight:600; margin-bottom:6px;}
  </style>
</head>
<body>
  <div class="app">
    <h1>📐 柱子平移与旋转计算器</h1>
    <div class="lead">输入两点数据自动计算平移与旋转（cm），默认两点距离 L=100</div>

    <div class="field pair-buttons">
      <div class="pair-btn active" id="btnNS">NS（南北）</div>
      <div class="pair-btn" id="btnEW">EW（东西）</div>
    </div>

    <div class="field">
      <label id="label1">点1 位移（cm）（南点）</label>
      <input id="d1" type="text" placeholder="正为东/北，负为西/南">
    </div>

    <div class="field">
      <label id="label2">点2 位移（cm）（北点）</label>
      <input id="d2" type="text" placeholder="正为东/北，负为西/南">
    </div>

    <div class="buttons">
      <button class="primary" id="calc">计算</button>
      <button class="ghost" id="reset">重置</button>
    </div>

    <div class="results">
      <div class="card full">
        <div class="val dir-gray" id="dirVal">—</div>
        <div class="sub">旋转方向</div>
      </div>
      <div class="card">
        <div class="val" id="tVal">—</div>
        <div class="sub">平移 t (cm)</div>
      </div>
      <div class="card">
        <div class="val" id="rthetaVal">—</div>
        <div class="sub">旋转线位移 rθ (cm)</div>
      </div>
      <div class="card">
        <div class="val" id="thetaDeg">—</div>
        <div class="sub">角度 θ (°)</div>
      </div>
    </div>

    <details>
      <summary>使用说明（含默认两点距离 L=100 cm）</summary>
      1. 选择点对类型：NS 为南北方向，EW 为东西方向；<br>
      2. 输入两点位移（正值表示向东/北，负值表示向西/南）；<br>
      3. 默认两点距离 L=100 cm，如需修改请手动设置；<br>
      4. 点击“计算”即可获得平移、旋转量与角度；<br>
      5. 旋转方向根据点位差自动判断，并显示旋转长度；<br>
      6. 所有单位均为厘米（cm）。
    </details>
  </div>

  <script>
    let pairType='NS';
    const btnNS=document.getElementById('btnNS');
    const btnEW=document.getElementById('btnEW');
    const label1=document.getElementById('label1');
    const label2=document.getElementById('label2');
    const d1=document.getElementById('d1');
    const d2=document.getElementById('d2');
    const tVal=document.getElementById('tVal');
    const rthetaVal=document.getElementById('rthetaVal');
    const thetaDeg=document.getElementById('thetaDeg');
    const dirVal=document.getElementById('dirVal');

    function updateLabels(){
      if(pairType==='NS'){
        label1.textContent='点1 位移（cm）（南点）';
        label2.textContent='点2 位移（cm）（北点）';
      } else {
        label1.textContent='点1 位移（cm）（西点）';
        label2.textContent='点2 位移（cm）（东点）';
      }
    }
    btnNS.onclick=()=>{pairType='NS'; btnNS.classList.add('active'); btnEW.classList.remove('active'); updateLabels();}
    btnEW.onclick=()=>{pairType='EW'; btnEW.classList.add('active'); btnNS.classList.remove('active'); updateLabels();}
    updateLabels();

    function parseVal(v){return parseFloat(v)||0;}

    document.getElementById('calc').onclick=()=>{
      const v1=parseVal(d1.value), v2=parseVal(d2.value), Lv=100;
      const t=(v1+v2)/2;
      const r=(v1-v2)/2;
      const theta=r/(Lv/2)*180/Math.PI;
      tVal.textContent=t.toFixed(2);
      rthetaVal.textContent=Math.abs(r).toFixed(2);
      thetaDeg.textContent=theta.toFixed(3);
      let dir='无旋转', cls='dir-gray';
      if(pairType==='NS'){
        if(v1>v2){dir=`逆时针（旋转 ${Math.abs(r).toFixed(2)} cm）`; cls='dir-red';}
        else if(v1<v2){dir=`顺时针（旋转 ${Math.abs(r).toFixed(2)} cm）`; cls='dir-green';}
      } else {
        if(v1>v2){dir=`顺时针（旋转 ${Math.abs(r).toFixed(2)} cm）`; cls='dir-green';}
        else if(v1<v2){dir=`逆时针（旋转 ${Math.abs(r).toFixed(2)} cm）`; cls='dir-red';}
      }
      dirVal.textContent=dir;
      dirVal.className='val '+cls;
    };

    document.getElementById('reset').onclick=()=>{
      d1.value=''; d2.value='';
      tVal.textContent=rthetaVal.textContent=thetaDeg.textContent='—';
      dirVal.textContent='—'; dirVal.className='val dir-gray';
    };
  </script>

  <!-- PWA Service Worker 注册 -->
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log('✅ Service Worker 注册成功'))
      .catch(err => console.log('❌ Service Worker 注册失败', err));
  }
  </script>
</body>
</html>
